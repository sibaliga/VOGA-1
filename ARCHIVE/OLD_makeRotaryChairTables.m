d_name = '/Volumes/';

MVI_home_dir = strrep(strcat(d_name,{'MVI/Study Subjects/MVI001_R019/',...
                'MVI/Study Subjects/MVI002_R004/',...
                'MVI/Study Subjects/MVI003_R140/',...
                'MVI/Study Subjects/MVI004_R201/',...
                'MVI/Study Subjects/MVI005_R107/',...
                'MVI/Study Subjects/MVI006_R296/',...
                'MVI/Study Subjects/MVI007_R765/',...
                'MVI/Study Subjects/MVI008_R021/',...
                'MVI/Study Subjects/MVI009_R908/'}),'/',filesep);

MVI1_paths = strrep(strcat(MVI_home_dir{1},...
    {'Visit 6/Rotary Chair/Cyc_Avg',...
    'Visit 7 - 6 wks sp activation/Rotary Chair/Cyc_Avg',...
    'Visit 9x/Rotary Chair/Cyc_Avg',...
    'Visit 10x/Rotary Chair/Cyc_Avg',...
    'Visit 11x/Rotary Chair/Cycle Averages'}),'/',filesep)';

MVI2_paths = strrep(strcat(MVI_home_dir{2},...
    {'Visit 0/Rotary Chair/Cyc_Avg',...
    'Visit 3/Rotary Chair/Cyc_Avg',...
    'Visit 4/Rotary Chair/Cyc_Avg',...
    'Visit 5/Rotary Chair/Cyc_Avg',...
    'Visit 6/Rotary Chair/Cyc_Avg',...
    'Visit 7/Rotary Chair/Cyc_Avg',...
    'Visit 8/Rotary Chair/Cyc_Avg',...
    'Visit 9x/Rotary Chair/Cyc_Avg',...
    'Visit 10x/Rotary Chair/Cycle Averages',...
    'Visit 11x/Rotary Chair/Cycle Averages'}),'/',filesep)';

MVI3_paths = strrep(strcat(MVI_home_dir{3},... 
    {'Visit 0/Rotary Chair/Cyc_Avg',...
    'Visit 3/Rotary Chair/Cyc_Avg',...
    'Visit 4/Rotary Chair/Cyc_Avg',...
    'Visit 5/Rotary Chair/Cyc_Avg',...
    'Visit 6/Rotary Chair/Cyc_Avg',...
    'Visit 7/Rotary Chair/Cyc_Avg',...
    'Visit 8/Rotary Chair/Cyc_Avg',...
    'Visit 9x/Rotary Chair/Cyc_Avg',...
    'Visit 10x/Rotary Chair/Cyc_Avg',...
    'Visit 11x/Rotary Chair/Cycle Averages'}),'/',filesep)';

MVI4_paths = strrep(strcat(MVI_home_dir{4},... 
    {'Visit 0/Rotary Chair/Cyc_Avg',...
    'Visit 3/Rotary Chair/Cyc_Avg',...
    'Visit 4/Rotary Chair/Cyc_Avg',...
    'Visit 5/Rotary Chair/Cyc_Avg',...
    'Visit 6/Rotary Chair/Cyc_Avg',...
    'Visit 7/Rotary Chair/Cyc_Avg',...
    'Visit 8/Rotary Chair/Cyc_Avg',...
    'Visit 9x/Rotary Chair/Cyc_Avg',...
    'Visit 10x/Rotary Chair/Cycle Averages'}),'/',filesep)';

MVI5_paths = strrep(strcat(MVI_home_dir{5},... 
    {'Visit 0-1-2/Visit 0/Rotary Chair/Cyc_Avg',...
    'Visit 3/Rotary Chair/Cyc_Avg',...
    'Visit 4/Rotary Chair/Cyc_Avg',...
    'Visit 5/Rotary Chair/Cyc_Avg',...
    'Visit 6/Rotary Chair/Cyc_Avg',...
    'Visit 7/Rotary Chair/Cyc_Avg',...
    'Visit 8/Rotary Chair/Cyc_Avg',...
    'Visit 9x/Rotary Chair/Cycle Averages',...
    'Visit 10x/Rotary Chair/NKI/Cycle Averages',...
    'Visit 10x/Rotary Chair/LDVOG/Cycle Averages'}),'/',filesep)';

MVI6_paths = strrep(strcat(MVI_home_dir{6},... 
    {'Visit 0-1-2/Visit 0/Rotary Chair/Cyc_Avg',...
    'Visit 3/Rotary Chair/Cyc_Avg',...
    'Visit 4/Rotary Chair/Cyc_Avg',...
    'Visit 5/Rotary Chair/Cyc_Avg',...
    'Visit 6/Rotary Chair/Cyc_Avg',...
    'Visit 7/Rotary Chair/Cyc_Avg',...
    'Visit 8/Rotary Chair/Cyc_Avg',...
    'Visit 9x/Rotary Chair/Cycle Averages',...
    'Visit 10x/Rotary Chair/NKI/Cycle Averages',...
    'Visit 10x/Rotary Chair/LDVOG/Cycle Averages',...
    'Visit 11x/Rotary Chair/NKI/Cycle Averages'}),'/',filesep)';

MVI7_paths = strrep(strcat(MVI_home_dir{7},...
    {'Visit 0-1-2/Visit 0/Rotary Chair/Cyc_Avg',...
    'Visit 3/Rotary Chair/Cyc_Avg',...
    'Visit 4/Rotary Chair/Cyc_Avg',...
    'Visit 6/Rotary Chair/Cyc_Avg',...
    'Visit 7/Rotary Chair/Cyc_Avg',...
    'Visit 8/Rotary Chair/Cyc_Avg',...
    'Visit 9x/Rotary Chair/Cyc_Avg'}),'/',filesep)';

MVI8_paths = strrep(strcat(MVI_home_dir{8},...
    {'Visit 0-1-2/Visit 0/Rotary Chair/Cyc_Avg',...
    'Visit 3/Rotary Chair/Cycle Averages',...
    'Visit 5x/Rotary Chair/Cycle Averages',...
    'Visit 7x/Rotary Chair/Cycle Averages',...
    'Visit 9x/Rotary Chair/Cycle Averages',...
    'Visit 10x/Rotary Chair/NKI/Cycle Averages',...
    'Visit 10x/Rotary Chair/LDVOG/Cycle Averages'}),'/',filesep)'; %Did 10x manually both goggles

MVI9_paths = strrep(strcat(MVI_home_dir{9},...
    {'Visit 0-1-2/Visit 0/Rotary Chair/NKI/Cycle Averages',...
    'Visit 0-1-2/Visit 0/Rotary Chair/LDVOG/Cycle Averages',...
    'Visit 3/Rotary Chair/NKI/Cycle Averages',...
    'Visit 3/Rotary Chair/LDVOG/Cycle Averages',...
    'Visit 5x/Rotary Chair/NKI/Cycle Averages',...
    'Visit 7x/Rotary Chair/LDVOG/Cycle Averages',...
    'Visit 7x/Rotary Chair/NKI/Cycle Averages'}),'/',filesep)';
%% Making tables from CycAvg
%paths = [MVI6_paths;MVI7_paths;MVI9_paths];
paths = [];
for i = 1:length(paths)
   disp(['Path ', num2str(i),' of ',num2str(length(paths))])
   parts = split(paths{i},filesep);
   out_path = strjoin(parts(1:end-1),filesep);
   MakeCycleSummaryTable(out_path,paths{i})
end
%% Making subject-wide tables
paths = MVI9_paths;
parts1 = split(paths{end},filesep);
out_path = strjoin(parts1(1:find(contains(parts1,'MVI'),1,'last')),filesep);
cat_all_results = table();
for i = 1:length(paths)
   disp(['Path ', num2str(i),' of ',num2str(length(paths))])
   parts = split(paths{i},filesep);
   tab_path = strjoin(parts(1:end-1),filesep);
   results_tab_name = extractfield(dir([tab_path,filesep,'*Results.mat']),'name');
   load([tab_path,filesep,results_tab_name{end}],'all_results')
   disp(all_results.Goggle)
   if isnumeric(all_results.Goggle)
       all_results.Goggle = strcat('LDVOG',cellstr(num2str(all_results.Goggle)));
       save([tab_path,filesep,results_tab_name{end}],'all_results')
   elseif any(~contains(all_results.Goggle,{'LDVOG','NKI'}))
       all_results.Goggle(~contains(all_results.Goggle,{'LDVOG','NKI'})) = strcat('LDVOG',all_results.Goggle(~contains(all_results.Goggle,{'LDVOG','NKI'})));
       save([tab_path,filesep,results_tab_name{end}],'all_results')
   end
   cat_all_results = [cat_all_results;all_results];
end
all_results = cat_all_results;
save([out_path,filesep,datestr(now,'yyyymmdd_HHMMSS'),'_',parts1{find(contains(parts1,'MVI'),1,'last')},'_RotaryChairResults.mat'],'all_results')
%% Make all-subject table
out_path = strrep([d_name,'MVI/DATA SUMMARY/IN PROGRESS/VOR - Rotary Chair'],'/',filesep);
cat_all_results = table();
for i = 1:length(MVI_home_dir)
   disp(['Path ', num2str(i),' of ',num2str(length(MVI_home_dir))])
   tab_path = MVI_home_dir{i};
   results_tab_name = extractfield(dir([tab_path,'*Results.mat']),'name');
   load([tab_path,filesep,results_tab_name{end}],'all_results')
   cat_all_results = [cat_all_results;all_results];
end
all_results = cat_all_results;
save([out_path,filesep,datestr(now,'yyyymmdd_HHMMSS'),'_RotaryChairResults.mat'],'all_results')